<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz PSI – bez React</title>
<style>
body {
    background:#121212; color:#fff; font-family:Arial;
    display:flex; justify-content:center; align-items:center;
    min-height:100vh; margin:0;
}
.quiz-container {
    background:#1e1e1e; padding:20px; border-radius:10px;
    width:90%; max-width:800px; text-align:center;
}
h1 { color:#bb86fc }
.btn {
    width:100%; padding:15px; margin:8px 0;
    background:#333; color:#fff; border:1px solid #555;
    border-radius:5px; cursor:pointer;
}
.menu-btn { background:#bb86fc; color:#000; font-weight:bold; }
.btn.correct { background:#4caf50 }
.btn.wrong { background:#f44336 }
.hidden { display:none }
#next-btn { background:#bb86fc; color:#000; display:none; margin:20px auto }
</style>
</head>

<body>

<div id="start-screen" class="quiz-container">
<h1>Quiz TI – bez React / TS</h1>

<button class="btn menu-btn" onclick="startSmart30()">
    Losowe 30
</button>

<button class="btn menu-btn" onclick="startAllSmart()">
    Wszystkie pytania
</button>

<button class="btn menu-btn" onclick="location.href='index.html'">
    Powrót
</button>
</div>


<div id="quiz-screen" class="quiz-container hidden">
<h1 id="quiz-title"></h1>
<p>Pytanie <span id="current-q">1</span> / <span id="total-q">0</span></p>
<div id="question-text"></div>
<div id="answer-buttons"></div>
<button id="next-btn" class="btn" onclick="nextQuestion()">Następne</button>
</div>

<script src="pytania.js"></script>
<script>
const USED='used_q', STATS='stats_q';
let questions=[], current=0, score=0;

questionsData.forEach((q,i)=>q.id=i);

function filter(data){
    const bad=['react','jsx','typescript','hook','usestate','useeffect'];
    return data.filter(q=>{
        const t=(q.question+' '+q.answers.join(' ')).toLowerCase();
        return !bad.some(b=>t.includes(b));
    });
}

function getStats(){ return JSON.parse(localStorage.getItem(STATS))||{} }
function saveStats(s){ localStorage.setItem(STATS,JSON.stringify(s)) }
function getUsed(){ return JSON.parse(localStorage.getItem(USED))||[] }
function saveUsed(u){ localStorage.setItem(USED,JSON.stringify(u)) }

function weightedPick(all){
    const stats=getStats(), used=getUsed();
    let pool=all.filter(q=>!used.includes(q.id));
    if(pool.length<30){ pool=[...all]; localStorage.removeItem(USED); }

    return pool.map(q=>{
        const s=stats[q.id];
        const w=s ? 1+s.wrong*3 : 1;
        return {q,w};
    }).sort(()=>Math.random()-0.5)
      .sort((a,b)=>b.w-a.w)
      .slice(0,30).map(e=>e.q);
}

function startSmart30(){
    const all = filter([...questionsData]);
    questions = weightedPick(all);

    document.getElementById('quiz-title')
        .innerText = `Bez React / TS – losowe (${questions.length})`;

    document.getElementById('total-q').innerText = questions.length;
    document.getElementById('start-screen').classList.add('hidden');
    document.getElementById('quiz-screen').classList.remove('hidden');
    show();
}

function startAllSmart(){
    const all = filter([...questionsData]);

    const stats = getStats();
    questions = all.sort((a, b) => {
        const wa = stats[a.id]?.wrong || 0;
        const wb = stats[b.id]?.wrong || 0;
        return wb - wa;
    });

    document.getElementById('quiz-title')
        .innerText = `Bez React / TS – wszystkie (${questions.length})`;

    document.getElementById('total-q').innerText = questions.length;
    document.getElementById('start-screen').classList.add('hidden');
    document.getElementById('quiz-screen').classList.remove('hidden');
    show();
}


function show(){
    const q = questions[current];
    document.getElementById('question-text').innerText = q.question;
    document.getElementById('current-q').innerText = current+1;
    const box = document.getElementById('answer-buttons');
    box.innerHTML='';
    document.getElementById('next-btn').style.display='none';

    // 1. Tworzymy pary: odpowiedź + oryginalny indeks
    let answersWithIndex = q.answers.map((text, index) => {
        return { text: text, originalIndex: index };
    });

    // 2. MIESZANIE ALGORYTMEM FISHERA-YATESA (Prawdziwa losowość)
    for (let i = answersWithIndex.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        // Zamiana miejscami
        [answersWithIndex[i], answersWithIndex[j]] = [answersWithIndex[j], answersWithIndex[i]];
    }

    // 3. Wyświetlanie
    answersWithIndex.forEach((item) => {
        const b = document.createElement('button');
        b.className = 'btn'; 
        b.innerText = item.text;
        
        // Zapisujemy oryginalny indeks, żeby wiedzieć czy to dobra odpowiedź
        b.dataset.idx = item.originalIndex;

        b.onclick = () => select(item.originalIndex, b);
        box.appendChild(b);
    });
}

function select(i, btn){
    const q = questions[current];
    const stats = getStats();
    if(!stats[q.id]) stats[q.id]={shown:0,wrong:0};
    stats[q.id].shown++;
    if(i !== q.correct) stats[q.id].wrong++;
    saveStats(stats);

    const used = getUsed(); 
    if(!used.includes(q.id)){ used.push(q.id); saveUsed(used); }

    [...document.getElementById('answer-buttons').children]
        .forEach(b => b.disabled = true);

    if(i === q.correct){ 
        btn.classList.add('correct'); 
        score++; 
    } else {
        btn.classList.add('wrong');
        
        // Znajdź poprawny przycisk wśród wymieszanych
        const buttons = document.getElementById('answer-buttons').children;
        for (let b of buttons) {
            if (parseInt(b.dataset.idx) === q.correct) {
                b.classList.add('correct');
            }
        }
    }
    document.getElementById('next-btn').style.display='block';
}

function nextQuestion(){
    current++;
    current<questions.length ? show() : end();
}

function end(){
    document.getElementById('question-text')
        .innerText=`Wynik: ${score}/${questions.length}`;
    document.getElementById('answer-buttons').innerHTML='';
    const b=document.getElementById('next-btn');
    b.innerText='Menu'; b.style.display='block';
    b.onclick=()=>location.reload();
}
</script>
</body>
</html>
